!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("React"),require("helmetModule"),require("sharedUtilsLibrary")):"function"==typeof define&&define.amd?define("extension",["React","helmetModule","sharedUtilsLibrary"],n):"object"==typeof exports?exports.extension=n(require("React"),require("helmetModule"),require("sharedUtilsLibrary")):e.extension=n(e.React,e.helmetModule,e.sharedUtilsLibrary)}("undefined"!=typeof self?self:this,((e,n,t)=>(()=>{"use strict";var a={173:e=>{e.exports=t},333:e=>{e.exports=n},883:n=>{n.exports=e}},r={};function i(e){var n=r[e];if(void 0!==n)return n.exports;var t=r[e]={exports:{}};return a[e](t,t.exports,i),t.exports}i.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return i.d(n,{a:n}),n},i.d=(e,n)=>{for(var t in n)i.o(n,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},i.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};i.r(o),i.d(o,{default:()=>f});var c={};i.r(c),i.d(c,{Component:()=>y,settings:()=>g});var l=i(883),s=i.n(l),d=i(173),u=i(333);const m={product:"gONOQ",lookText:"Bn1NG",maincontainers:"eXEUf",bundlings:"lrM6Q",bundles:"MMJNd",bundle1:"Xw8BJ",bundle2:"qaLKB",bundle3:"zzLsR",bundlingoutfits:"_GHEH",btn:"SUgml",modal:"dZ7I_",fadeIn:"zb8ud",modalContent:"LYzKO",scaleIn:"mZk4U",formGroup:"h6W7I",input:"LLpaI",select:"x16sB",modalActions:"heSoP",confirmBtn:"cCASC",cancelBtn:"xP_1t",price:"q7Ot2",effectivePrice:"mcMu9"};function p({product:e,fpi:n}){const[t,a]=(0,l.useState)(!1),[r,i]=(0,l.useState)(!1),[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(""),[p,_]=(0,l.useState)([]),[y,g]=(0,l.useState)(null),f="\n        query locality($locality: LocalityEnum!, $localityValue: String!, $country: String) {\n            locality(locality: $locality, localityValue: $localityValue, country: $country) {\n                display_name\n                id\n                name\n                parent_ids\n                type\n                localities {\n                    id\n                    name\n                    display_name\n                    parent_ids\n                    type\n                }\n            }\n        }\n    ";s().useEffect((()=>{_(["XS","S","M","L","XL","OS"]),u("OS")}),[]);const b=async(n,t)=>{try{const a={batch:[{context:{library:{name:"flick",version:"1.0.4"},os:{name:navigator.platform.includes("Mac")?"Mac OS":"Windows",version:"10.15.7"},timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,screen:{width:window.screen.width,height:window.screen.height},user_agent:navigator.userAgent,locale:navigator.language,device:{is_mobile:/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}},event_id:v(),event_name:"add_to_cart",properties:{cart_id:n.id,event_type:"engagement",product_id:e.uid||parseInt(e.slug.split("-").pop()),article_id:t.article_id,brand:e.brand?.name||"Generic",l3_category:e.categories?.[0]?.name||"Unknown",currency:"INR",quantity:1,position:null,query:null,f_medium:"",f_source:"",f_campaign:"",utm_medium:"",utm_source:"",utm_campaign:"",search_id:null,previous_cart_id:n.id},event_timestamp:(new Date).toISOString(),user_id:null,anonymous_id:v()}],sent_at:(new Date).toISOString()};await fetch("/api/service/application/webhook/v1.0/click-analytics/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch(e){console.error("Analytics event failed:",e)}},v=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)}));return s().createElement("div",{className:m.product},e.media?.[0]&&s().createElement("img",{src:e.media[0].url,alt:e.media[0].alt}),s().createElement("h1",{className:m.name},e.name),e.price&&s().createElement("div",{className:m.price},s().createElement("span",{className:m.effectivePrice},e.price.effective?.currency_symbol,e.price.effective?.min),e.price.effective?.max!==e.price.effective?.min&&s().createElement("span",null," - ",e.price.effective?.currency_symbol,e.price.effective?.max)),s().createElement("button",{className:m.btn,onClick:()=>{i(!0)},disabled:t},t?"Adding...":"Add to Cart"),r&&s().createElement("div",{className:m.modal},s().createElement("div",{className:m.modalContent},s().createElement("h3",null,"Check Serviceability"),s().createElement("div",{className:m.formGroup},s().createElement("label",null,"Pincode:"),s().createElement("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Enter 6-digit pincode (e.g., 400001)",className:m.input,maxLength:"6"})),s().createElement("div",{className:m.formGroup},s().createElement("label",null,"Size:"),s().createElement("select",{value:d,onChange:e=>u(e.target.value),className:m.select},p.map((e=>s().createElement("option",{key:e,value:e},e))))),s().createElement("div",{className:m.modalActions},s().createElement("button",{onClick:async()=>{if(!o||!d)return void alert("Please enter pincode and select size");const t=o.replace(/\D/g,"");if(6===t.length)try{let r,o;a(!0),console.log("Debug Info:",{pincode:t,selectedSize:d,productSlug:e.slug,productUid:e.uid}),console.log("Step 1: Checking locality...");const c=[{country:"IN",query:f},{country:"IND",query:f},{country:null,query:"\n        query locality($locality: LocalityEnum!, $localityValue: String!) {\n            locality(locality: $locality, localityValue: $localityValue) {\n                display_name\n                id\n                name\n                parent_ids\n                type\n                localities {\n                    id\n                    name\n                    display_name\n                    parent_ids\n                    type\n                }\n            }\n        }\n    "}];for(const e of c)try{console.log("Trying approach:",e);const a={locality:"pincode",localityValue:t};if(e.country&&(a.country=e.country),r=await n.executeGQL(e.query,a),console.log("Result:",r),o=r?.data?.locality||r?.locality,o&&!r?.errors){console.log("✅ Success with approach:",e);break}r?.errors&&console.log("❌ Error with approach:",e,r.errors)}catch(n){console.log("❌ Exception with approach:",e,n.message);continue}if(!o)return console.error("All locality approaches failed"),r?.errors?alert(`Locality Error: ${r.errors[0]?.message||"Unknown error"}`):alert("Invalid pincode or locality service unavailable"),void a(!1);console.log("✅ Locality validated successfully:",o),console.log("Step 2: Checking product price...");const l=await n.executeGQL("\n        query ProductPrice($slug: String!, $size: String!, $pincode: String!) {\n            productPrice(slug: $slug, size: $size, pincode: $pincode) {\n                article_id\n                discount\n                is_cod\n                is_gift\n                item_type\n                long_lat\n                pincode\n                quantity\n                seller_count\n                special_badge\n                price_per_piece {\n                    currency_code\n                    currency_symbol\n                    effective\n                    marked\n                    selling\n                }\n                price {\n                    currency_code\n                    currency_symbol\n                    effective\n                    marked\n                    selling\n                }\n                price_per_unit {\n                    currency_code\n                    currency_symbol\n                    price\n                    unit\n                }\n                return_config {\n                    returnable\n                    time\n                    unit\n                }\n                seller {\n                    count\n                    name\n                    uid\n                }\n                set {\n                    quantity\n                }\n                store {\n                    uid\n                    name\n                    count\n                }\n                strategy_wise_listing {\n                    distance\n                    pincode\n                    quantity\n                    tat\n                }\n                grouped_attributes {\n                    title\n                    details {\n                        key\n                        type\n                        value\n                    }\n                }\n                article_assignment {\n                    level\n                    strategy\n                }\n                delivery_promise {\n                    max\n                    min\n                }\n                discount_meta {\n                    end\n                    start\n                    start_timer_in_minutes\n                    timer\n                }\n            }\n        }\n    ",{slug:e.slug,size:d,pincode:t});console.log("Price Result:",l);const s=l?.data?.productPrice||l?.productPrice;if(!s)return console.error("No price data found"),l?.errors?alert(`Product Price Error: ${l.errors[0]?.message||"Unknown error"}`):alert("Product not available for this pincode and size combination"),void a(!1);console.log("✅ Product price validated successfully:",s),g(s),await(async(t,r)=>{try{console.log("Step 3: Adding to cart...");const a=e.uid||parseInt(e.slug.split("-").pop());console.log("Cart Item Details:",{itemId:a,articleId:t.article_id,sellerId:t.seller.uid,storeId:t.store.uid,size:d,pincode:r});const o=await n.executeGQL("\n        mutation AddItemsToCart($buyNow: Boolean, $areaCode: String!, $addCartRequestInput: AddCartRequestInput) {\n            addItemsToCart(buyNow: $buyNow, areaCode: $areaCode, addCartRequestInput: $addCartRequestInput) {\n                message\n                partial\n                success\n                cart {\n                    buy_now\n                    cart_id\n                    checkout_mode\n                    comment\n                    coupon_text\n                    delivery_charge_info\n                    gstin\n                    id\n                    is_valid\n                    message\n                    restrict_checkout\n                    user_cart_items_count\n                    uid\n                    items {\n                        bulk_offer\n                        coupon_message\n                        custom_order\n                        discount\n                        is_set\n                        key\n                        message\n                        moq\n                        parent_item_identifiers\n                        product_ean_id\n                        quantity\n                        availability {\n                            deliverable\n                            is_valid\n                            other_store_quantity\n                            out_of_stock\n                            sizes\n                            available_sizes {\n                                display\n                                is_available\n                                value\n                            }\n                        }\n                        article {\n                            _custom_json\n                            cart_item_meta\n                            extra_meta\n                            gift_card\n                            identifier\n                            is_gift_visible\n                            meta\n                            mto_quantity\n                            parent_item_identifiers\n                            product_group_tags\n                            quantity\n                            seller_identifier\n                            size\n                            tags\n                            uid\n                            seller {\n                                name\n                                uid\n                            }\n                            price {\n                                base {\n                                    currency_code\n                                    currency_symbol\n                                    effective\n                                    marked\n                                }\n                                converted {\n                                    currency_code\n                                    currency_symbol\n                                    effective\n                                    marked\n                                }\n                            }\n                        }\n                        price_per_unit {\n                            base {\n                                currency_code\n                                currency_symbol\n                                effective\n                                marked\n                                selling_price\n                            }\n                            converted {\n                                currency_code\n                                currency_symbol\n                                effective\n                                marked\n                                selling_price\n                            }\n                        }\n                        product {\n                            attributes\n                            item_code\n                            name\n                            slug\n                            tags\n                            type\n                            uid\n                            brand {\n                                name\n                                uid\n                            }\n                            action {\n                                type\n                                url\n                            }\n                            categories {\n                                name\n                                uid\n                            }\n                            images {\n                                aspect_ratio\n                                secure_url\n                                url\n                            }\n                        }\n                        promo_meta {\n                            message\n                        }\n                        promotions_applied {\n                            amount\n                            article_quantity\n                            code\n                            meta\n                            mrp_promotion\n                            offer_text\n                            promo_id\n                            promotion_group\n                            promotion_name\n                            promotion_type\n                            applied_free_articles {\n                                article_id\n                                parent_item_identifier\n                                quantity\n                                free_gift_item_details {\n                                    item_brand_name\n                                    item_id\n                                    item_images_url\n                                    item_name\n                                    item_price_details {\n                                        currency\n                                        marked {\n                                            min\n                                            max\n                                        }\n                                        effective {\n                                            min\n                                            max\n                                        }\n                                    }\n                                    item_slug\n                                }\n                            }\n                            discount_rules {\n                                item_criteria\n                                matched_buy_rules\n                                offer\n                                raw_offer\n                            }\n                        }\n                        charges {\n                            meta\n                            name\n                            allow_refund\n                            code\n                            type\n                            amount {\n                                currency\n                                value\n                            }\n                        }\n                        coupon {\n                            code\n                            discount_single_quantity\n                            discount_total_quantity\n                        }\n                        identifiers {\n                            identifier\n                        }\n                        price {\n                            base {\n                                currency_code\n                                currency_symbol\n                                effective\n                                marked\n                            }\n                            converted {\n                                currency_code\n                                currency_symbol\n                                effective\n                                marked\n                            }\n                        }\n                        delivery_promise {\n                            formatted {\n                                max\n                                min\n                            }\n                            timestamp {\n                                max\n                                min\n                            }\n                            iso {\n                                max\n                                min\n                            }\n                        }\n                    }\n                    breakup_values {\n                        coupon {\n                            code\n                            coupon_type\n                            coupon_value\n                            description\n                            is_applied\n                            message\n                            minimum_cart_value\n                            sub_title\n                            title\n                            type\n                            uid\n                            value\n                        }\n                        display {\n                            currency_code\n                            currency_symbol\n                            display\n                            key\n                            message\n                            value\n                            preset\n                        }\n                        loyalty_points {\n                            applicable\n                            description\n                            is_applied\n                            total\n                        }\n                        raw {\n                            cod_charge\n                            convenience_fee\n                            coupon\n                            delivery_charge\n                            discount\n                            fynd_cash\n                            gift_card\n                            gst_charges\n                            mop_total\n                            mrp_total\n                            subtotal\n                            total\n                            vog\n                            you_saved\n                            total_charge\n                        }\n                    }\n                }\n            }\n        }\n    ",{buyNow:!1,areaCode:r,addCartRequestInput:{items:[{article_assignment:t.article_assignment,article_id:t.article_id,item_id:a,item_size:d,quantity:1,seller_id:t.seller.uid,store_id:t.store.uid}]}});console.log("Add to Cart Result:",o);const c=o?.data?.addItemsToCart||o?.addItemsToCart;c?.success?(await n.executeGQL("\n        query Cart($areaCode: String, $assignCardId: Int, $includeBreakup: Boolean, $buyNow: Boolean, $includeAllItems: Boolean, $includeCodCharges: Boolean, $cartId: String) {\n            cart(areaCode: $areaCode, assignCardId: $assignCardId, includeBreakup: $includeBreakup, buyNow: $buyNow, includeAllItems: $includeAllItems, includeCodCharges: $includeCodCharges, id: $cartId) {\n                buy_now\n                cart_id\n                checkout_mode\n                comment\n                coupon_text\n                delivery_charge_info\n                gstin\n                id\n                is_valid\n                message\n                restrict_checkout\n                user_cart_items_count\n                uid\n                success\n            }\n        }\n    ",{buyNow:!1,includeAllItems:!0,includeBreakup:!0}),await b(c.cart,t),alert("Product added to cart successfully!"),i(!1)):(console.error("Add to cart failed:",c),alert(`Failed to add product to cart: ${c?.message||"Unknown error"}`))}catch(e){console.error("Add to cart failed:",e),alert(`Failed to add product to cart: ${e.message}`)}finally{a(!1)}})(s,t)}catch(e){console.error("Serviceability check failed:",e),alert(`Failed to check serviceability: ${e.message}`),a(!1)}else alert("Please enter a valid 6-digit pincode")},disabled:t,className:m.confirmBtn},t?"Processing...":"Add to Cart"),s().createElement("button",{onClick:()=>i(!1),className:m.cancelBtn},"Cancel")))))}const _="query products($first: Int, $pageNo: Int, $enableFilter: Boolean, $pageType: String) {\n  products(first: $first, pageNo: $pageNo, enableFilter: $enableFilter, pageType: $pageType) {\n    items {\n      price {\n        effective {\n          currency_code\n          currency_symbol\n          max\n          min\n        }\n      }\n      media {\n        alt\n        type\n        url\n      }\n      slug\n      name\n      uid\n      embeddings\n      brand {\n        name\n        uid\n      }\n      categories {\n        name\n        uid\n      }\n    }\n  }\n}";function y({title:e="Extension Title Default"}){const n=(0,d.useFPI)(),t=(0,d.useGlobalStore)(n.getters.PRODUCTS),a=t?.items??[],[r,i]=(0,l.useState)([]),[o,c]=(0,l.useState)({}),[y,g]=(0,l.useState)(null);return(0,l.useEffect)((()=>{if("undefined"!=typeof window){const e=window.location.pathname.split("/product/")[1];g(e)}}),[]),(0,l.useEffect)((()=>{console.log("recommendedBundles",o),console.log("formattedSlug",y)}),[o,y]),(0,l.useEffect)((()=>{a.length?i(a):(async()=>{let e=[],t=1,a=!0;for(;a;){const r={enableFilter:!0,first:50,pageNo:t,pageType:"number"};try{const i=await n.executeGQL(_,r),o=i?.products?.items||[];e=[...e,...o],o.length<50?a=!1:t++}catch(e){console.error("Failed to fetch products:",e),a=!1}}return i(e),n.custom.setValue(n.getters.PRODUCTS,{items:e}),e})().then((e=>{i(e)}))}),[a.length,n]),(0,l.useEffect)((()=>{y&&r.length>0&&(async(e=r)=>{const n=e.find((e=>e.slug===y));console.log("targetProduct",n);const t={company_id:10368,slug:n.slug};console.log("Request Data:",t);const a={"Content-Type":"application/json"};try{const e=await fetch("https://asia-south1.workflow.boltic.app/a5d3c126-e0e7-4228-bc1f-86ba7d93dfb5/bundling",{method:"POST",headers:a,body:JSON.stringify(t)});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();console.log("Response:",n),c(n.recommended_bundles)}catch(e){console.error("Request failed:",e)}})(r)}),[y,r]),r.length?s().createElement("div",{className:m.maincontainers},s().createElement(u.Helmet,null,s().createElement("title",null,e)),s().createElement("h2",{className:m.lookText},"Complete the look"),s().createElement("br",null),s().createElement("div",{className:m.bundlings}),s().createElement("div",{className:m.bundles},o?.target&&s().createElement(s().Fragment,null,r.filter((e=>e.slug===o.target.slug)).map((e=>s().createElement(p,{product:e,key:e.slug,fpi:n}))),o.recommended_outfits?.map(((e,t)=>{const a=e[0],i=r.find((e=>e.slug===a.slug));return i?s().createElement(p,{product:i,key:i.slug,fpi:n}):null}))))):s().createElement("h2",null,"Loading Products...")}y.serverFetch=({fpi:e})=>(e.custom.setValue("test-extension",!0),e.executeGQL(_,{enableFilter:!0,first:50,pageNo:1,pageType:"number"}));const g={label:"Product List",name:"product-list",props:[{id:"title",label:"Page Title",type:"text",default:"Extension Title",info:"Set the page title for the product list."}],blocks:[]},f={"product-list":{...c}};return o})()));